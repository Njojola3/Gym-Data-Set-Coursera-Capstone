---
title: "Coursera Data Analyst Capstone"
author: "Nicholas A. Jojola"
date: "2025-09-10"
output: github_document

---
rmarkdown::render("Coursera-Data-Analyst-Capstone.Rmd", output_format = "github_document")

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = FALSE,
    message = FALSE,
    warning = FALSE,
    fig.width = 7,
    fig.height = 5
)

library(dplyr)
library(janitor)
library(stringr)
library(ggplot2)
library(broom)
library(knitr)
library(kableExtra)
library(forcats)
```
### Introduction
In this theoretical setting I will be acting as a data analyst for a fitness company looking to improve their recommendations for new members based on their fitness goals.

```{r download}
# Download data if not exists
url <- "https://storage.googleapis.com/kagglesdsdata/datasets/5825454/9559728/gym_members_exercise_tracking.csv"
if (!file.exists("gym_members_exercise_tracking.csv")) {
  download.file(url, destfile = "gym_members_exercise_tracking.csv", mode = "wb")
}
```
### Clean
In data cleaning we started with data uniformity, converting column names and character data points into lowercase as well as trimming any unnecessary values e.g. hidden spaces.

Next, we re-coded the gender column to ensure all factors were either male or female, converting possible data points “m” to male, and “f” to female.

We then converted the age column to integers in the case that information was entered into as a type that may not be recognized later in our exploration.

Finally, we filtered age to only include the age range of 10-100, and weight to only include 60-600 lbs. as anything outside of these would most likely be a mistakes or outliers and of course dropped any duplicate entries.

```{r clean-data}
gym_data <- read.csv("gym_members_exercise_tracking.csv") %>%
  clean_names() %>%
  mutate(across(where(is.character), ~ str_to_lower(str_trim(.))),
    gender = recode(gender, "m" = "male", "f" = "female"),
    age = as.integer(age),
    weight_lb = weight_kg * 2.20462) %>%
  filter(is.na(age) | between(age, 10, 100)) %>%
  filter(is.na(weight_lb) | between(weight_lb, 60, 600)) %>%
  distinct()

# Derive hours/week (needed for analyses)
clean_gym_data <- gym_data %>%
  mutate(hours_per_week = session_duration_hours * workout_frequency_days_week)

qc <- tibble(
  column   = names(clean_gym_data),
  n_na     = sapply(clean_gym_data, \(x) sum(is.na(x))),
  n_unique = sapply(clean_gym_data, \(x) dplyr::n_distinct(x))
)
kable(qc, caption = "QC: Missingness and Uniqueness by Column") %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped","hover","condensed"))
```
```{r analysis frame}
# Build analysis frame
df <- clean_gym_data %>%
  mutate(
    gender        = factor(gender),
    workout_type  = factor(workout_type),
    age_group     = cut(age, breaks = c(18, 29, 39, 49, 59, Inf),
      labels = c("18–29","30–39","40–49","50–59","60+"),
      right = TRUE, include.lowest = TRUE),
    predicted_max = 220 - age,
    cardio_score  = ifelse(!is.na(max_bpm) & !is.na(predicted_max) & predicted_max > 0,
      max_bpm / predicted_max, NA_real_)
  )

# ------- Summary table -------
summary_tbl <- df %>%
  group_by(gender, workout_type) %>%
  summarise(
    n            = n(),
    hours_median = median(hours_per_week, na.rm = TRUE),
    hours_IQR    = IQR(hours_per_week, na.rm = TRUE),
    bpm_median   = median(max_bpm, na.rm = TRUE),
    fat_median   = median(fat_percentage, na.rm = TRUE),
    fat_IQR      = IQR(fat_percentage, na.rm = TRUE),
    .groups = "drop"
  )
```
### Explore
In this section, we will investigate the relationships between demographic and behavioral factors—such as gender, workout type, and weekly exercise duration—and key health outcomes including body fat percentage, estimated cardiovascular fitness. Our goal is to identify meaningful patterns that may inform recommendations for new gym members based on their fitness goals.

### Body Fat and Workout Type
As you can see from the scatter plots there is a clear and distinct negative correlation between body fat percentage and hours per week spent in the gym. 

HITT and cardio show the strongest negative correlation between hours of exercise per week and body fat. Strength and yoga show a strong negative correlation as well, however not as profound.

There doesn't seem to be any significant correlation between body fat percentage and max BPM. 

There is a clear difference in body fat between men and women as expected due to biological differences between the two group; women on average having naturally higher body fat percentages. 

```{r, echo=FALSE}
kable(summary_tbl, caption = "Summary by Gender × Workout Type") %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped","hover","condensed"))

# ------- Scatterplots -------
p_hours <- ggplot(df, aes(hours_per_week, fat_percentage, color = gender)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ workout_type) +
  labs(title = "Body Fat % vs Weekly Hours by Workout Type", x = "Hours per Week", y = "Body Fat %") +
  theme_minimal()
print(p_hours)

p_bpm <- ggplot(df, aes(max_bpm, fat_percentage, color = gender)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ workout_type) +
  labs(title = "Body Fat % vs Max BPM by Workout Type", x = "Max BPM", y = "Body Fat %") +
  theme_minimal()
print(p_bpm)
```

### Box Plots

In the box plots we can see that the median body fat percentage across all workout types are insignificant; however, HITT has a much wider spread indicating that there is a larger variability among this group, further exploration is needed to see if this spread is due to other factors. 
```{r, echo=FALSE}
# ------- Boxplot -------
p_box <- ggplot(df, aes(workout_type, fat_percentage, fill = gender)) +
  geom_boxplot(outlier.alpha = 0.2) +
  labs(title = "Body Fat % by Workout Type × Gender", x = "Workout Type", y = "Body Fat %") +
  theme_minimal()
print(p_box)
```

### Regression

In the regression coefficient table below we can see that holding the workout type variables constant, gym goings can expect an estimated 1.9% decrease in body fat per hour they spend in the gym each week with no statistical significance between groups.

```{r, echo=FALSE}
# ------- Regression: Fat % model -------
mod_fat <- lm(fat_percentage ~ gender + workout_type + hours_per_week + max_bpm, data = df)
coef_fat <- tidy(mod_fat, conf.int = TRUE) %>%
  mutate(term = recode(term,
    "(Intercept)"="Intercept",
    "gendermale"="Male (vs Female)",
    "workout_typehiit"="HIIT (vs baseline)",
    "workout_typestrength"="Strength (vs baseline)",
    "workout_typeyoga"="Yoga (vs baseline)",
    "hours_per_week"="Hours per week",
    "max_bpm"="Max BPM"))
fit_fat  <- glance(mod_fat)[, c("r.squared","adj.r.squared","sigma","df","p.value","AIC","BIC")]
kable(coef_fat, digits = 3, caption = "Regression Coefficients: Fat % Model") %>%
  kable_styling(full_width = FALSE)
kable(fit_fat, digits = 3, caption = "Model Fit: Fat % Model") %>%
  kable_styling(full_width = FALSE)
```

### Interpret 

From our analysis we can confidently say that body fat percentage is highly correlated with hours spent per week exercising regardless of workout type with the most variation in HITT workouts 

We were unable to find any significant correlation between workout types and cardiovascular health although our data being limited to a single point in time.

### Communicate

Based on our findings we can conclude that hours per week and body fat percentage are strongly correlated. This can give an initial recommendation for spending more time exercising and allow new gym members what to expect from exercise in general. 

To discover fat loss and cardiovascular health we will need too collect more data to give our clients better recommendations.

### Act

Our next steps would be to train implement programs for new gym members looking to lose body fat to spend more time exercising.

Suggestions would be meeting with personal trainers and sign up for classes such as HITT and yoga that keep new gym members structure and accountability.

Lastly. we will want to collect more data and continue our analysis to give more new gym members for advanced recommendations. 